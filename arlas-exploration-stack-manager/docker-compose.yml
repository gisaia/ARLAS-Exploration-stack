version: "3"

networks:
  default:
    external:
      name: arlas

services:
  server:
    env_file:
      - /environment/default/arlas-exploration-stack-server
      - /environment/user/arlas-exploration-stack-server
    image: gisaia/arlas-server:$ARLAS_STACK_SERVER_VERSION
    container_name: arlas-exploration-stack-server
    ports:
      - $ARLAS_STACK_SERVER_PORT:9999
    command: ["sh", "-c", "/opt/app/wait-for-elasticsearch.sh $$ARLAS_ELASTIC_HOST $$ARLAS_ELASTIC_PORT"] # TODO: replace `elasticsearch` `9300` by 1st element of ARLAS_ELASTIC_NODES. Port is optional in ARLAS_ELASTIC_NODES, if none given, use 9200
  WUI:
    env_file:
      - /environment/default/arlas-exploration-stack-wui
      - /environment/user/arlas-exploration-stack-wui
    image: gisaia/arlas-wui:$ARLAS_STACK_WUI_VERSION
    container_name: arlas-exploration-stack-wui
    ports:
      - $ARLAS_STACK_WUI_PORT:80
    volumes:
      - wui-configuration:/usr/share/nginx/html/

volumes:
  wui-configuration:
