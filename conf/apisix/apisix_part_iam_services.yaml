  -
    uri: /iam
    plugins:
      redirect:
        uri: /iam/
      response-rewrite:
        headers: 
          set:
            # Fix CWE Id: 693
            Content-Security-Policy: "default-src https: data: blob: 'self'; connect-src 'self' data: blob:; media-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob:; font-src 'self'; img-src 'self' data: blob:; frame-ancestors 'none'; form-action 'self'; object-src 'none'; manifest-src 'self'; frame-src 'self'"
            # Fix CWE Id: 200
            Server: "ARLAS services"
            # Fix CWE Id: 319 // Value recommended by https://hstspreload.org/
            Strict-Transport-Security: max-age=63072000; includeSubDomains; preload
            # Fix CWE Id: 693
            X-Content-Type-Options: nosniff
  -
    uri: /iam/*
    upstream:
      nodes:
        "arlas-wui-iam:80": 1
    plugins:
      response-rewrite:
        headers: 
          set:
            # Fix CWE Id: 693
            Content-Security-Policy: "default-src https: data: blob: 'self'; connect-src 'self' data: blob:; media-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob:; font-src 'self'; img-src 'self' data: blob:; frame-ancestors 'none'; form-action 'self'; object-src 'none'; manifest-src 'self'; frame-src 'self'"
            # Fix CWE Id: 1021
            X-Frame-Options: "DENY"
            # Fix CWE Id: 693 // The () means those resources are not allowed.
            Permissions-Policy: accelerometer=(), camera=(), microphone=(), geolocation=(), usb=()
            # Fix CWE Id: 200
            Server: "ARLAS services"
            # Fix CWE Id: 319 // Value recommended by https://hstspreload.org/
            Strict-Transport-Security: max-age=63072000; includeSubDomains; preload
            # Fix CWE Id: 693
            X-Content-Type-Options: nosniff
  -
    uri: /arlas_iam_server/*
    upstream:
      nodes:
        "arlas-iam-server:9998": 1
    plugins:
      proxy-rewrite:
        headers: 
          set:
            # Fix CWE Id: 1021
            Access-Control-Allow-Origin: "https://${ARLAS_HOST}"
      response-rewrite:
        headers: 
          set:
            # Fix CWE Id: 693
            Content-Security-Policy: "default-src https: data: blob: 'self'; connect-src 'self' data: blob:; media-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob:; font-src 'self'; img-src 'self' data: blob:; frame-ancestors 'none'; form-action 'self'; object-src 'none'; manifest-src 'self'; frame-src 'self'"
            # Fix CWE Id: 200
            Server: "ARLAS services"
            # Fix CWE Id: 319 // Value recommended by https://hstspreload.org/
            Strict-Transport-Security: max-age=63072000; includeSubDomains; preload
            # Fix CWE Id: 693
            X-Content-Type-Options: nosniff
  -
    uri: /arlas_iam_server/healthcheck
    methods: ["GET"]
    upstream:
      nodes:
        "arlas-iam-server:9998": 1
    plugins:
      proxy-rewrite:
        regex_uri: ["/arlas_iam_server/healthcheck", "/admin/healthcheck"]
      response-rewrite:
        headers: 
          set:
            # Fix CWE Id: 693
            Content-Security-Policy: "default-src https: data: blob: 'self'; connect-src 'self' data: blob:; media-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob:; font-src 'self'; img-src 'self' data: blob:; frame-ancestors 'none'; form-action 'self'; object-src 'none'; manifest-src 'self'; frame-src 'self'"
            # Fix CWE Id: 200
            Server: "ARLAS services"
            # Fix CWE Id: 319 // Value recommended by https://hstspreload.org/
            Strict-Transport-Security: max-age=63072000; includeSubDomains; preload
            # Fix CWE Id: 693
            X-Content-Type-Options: nosniff
