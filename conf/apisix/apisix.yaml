routes:
  -
    uri: /builder
    upstream:
      nodes:
        "arlas-builder:80": 1
    plugins:
      redirect:
        uri: /builder/
      response-rewrite:
        headers: 
          set:
            # Fix CWE Id: 693
            Content-Security-Policy: "default-src https: data: blob: 'self'; connect-src 'self' data: blob:; media-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob:; font-src 'self'; img-src 'self' data: blob:; frame-ancestors 'none'; form-action 'self'; object-src 'none'; manifest-src 'self'; frame-src 'self'"
            # Fix CWE Id: 200
            Server: "ARLAS services"
            # Fix CWE Id: 319 // Value recommended by https://hstspreload.org/
            Strict-Transport-Security: max-age=63072000; includeSubDomains; preload
            # Fix CWE Id: 693
            X-Content-Type-Options: nosniff
  -
    uri: /builder/*
    upstream:
      nodes:
        "arlas-builder:80": 1
      # response-rewrite:
      #   headers: 
      #     set:
      #       # Fix CWE Id: 693
      #       Content-Security-Policy: "default-src https: data: blob: 'self'; connect-src 'self' data: blob:; media-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob:; font-src 'self'; img-src 'self' data: blob:; frame-ancestors 'none'; form-action 'self'; object-src 'none'; manifest-src 'self'; frame-src 'self'"
      #       # Fix CWE Id: 1021
      #       X-Frame-Options: "DENY"
      #       # Fix CWE Id: 693 // The () means those resources are not allowed.
      #       Permissions-Policy: accelerometer=(), camera=(), microphone=(), geolocation=(), usb=()
      #       # Fix CWE Id: 200
      #       Server: "ARLAS services"
      #       # Fix CWE Id: 319 // Value recommended by https://hstspreload.org/
      #       Strict-Transport-Security: max-age=63072000; includeSubDomains; preload
      #       # Fix CWE Id: 693
      #       X-Content-Type-Options: nosniff
    plugins:
      proxy-rewrite:
        regex_uri: ["/builder/(.*)", "/$1"]
  -
    uri: /
    plugins:
      redirect:
        uri: /hub/
        plugins:
      response-rewrite:
        headers: 
          set:
            # Fix CWE Id: 693
            Content-Security-Policy: "default-src https: data: blob: 'self'; connect-src 'self' data: blob:; media-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob:; font-src 'self'; img-src 'self' data: blob:; frame-ancestors 'none'; form-action 'self'; object-src 'none'; manifest-src 'self'; frame-src 'self'"
            # Fix CWE Id: 200
            Server: "ARLAS services"
            # Fix CWE Id: 319 // Value recommended by https://hstspreload.org/
            Strict-Transport-Security: max-age=63072000; includeSubDomains; preload
            # Fix CWE Id: 693
            X-Content-Type-Options: nosniff
  -
    uri: /hub
    plugins:
      redirect:
        uri: /hub/
      response-rewrite:
        headers: 
          set:
            # Fix CWE Id: 693
            Content-Security-Policy: "default-src https: data: blob: 'self'; connect-src 'self' data: blob:; media-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob:; font-src 'self'; img-src 'self' data: blob:; frame-ancestors 'none'; form-action 'self'; object-src 'none'; manifest-src 'self'; frame-src 'self'"
            # Fix CWE Id: 200
            Server: "ARLAS services"
            # Fix CWE Id: 319 // Value recommended by https://hstspreload.org/
            Strict-Transport-Security: max-age=63072000; includeSubDomains; preload
            # Fix CWE Id: 693
            X-Content-Type-Options: nosniff
  -
    uri: /hub/*
    upstream:
      nodes:
        "arlas-hub:80": 1
    plugins:
      response-rewrite:
        headers: 
          set:
            # Fix CWE Id: 693
            Content-Security-Policy: "default-src https: data: blob: 'self'; connect-src 'self' data: blob:; media-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob:; font-src 'self'; img-src 'self' data: blob:; frame-ancestors 'none'; form-action 'self'; object-src 'none'; manifest-src 'self'; frame-src 'self'"
            # Fix CWE Id: 1021
            X-Frame-Options: "DENY"
            # Fix CWE Id: 693 // The () means those resources are not allowed.
            Permissions-Policy: accelerometer=(), camera=(), microphone=(), geolocation=(), usb=()
            # Fix CWE Id: 200
            Server: "ARLAS services"
            # Fix CWE Id: 319 // Value recommended by https://hstspreload.org/
            Strict-Transport-Security: max-age=63072000; includeSubDomains; preload
            # Fix CWE Id: 693
            X-Content-Type-Options: nosniff
      proxy-rewrite:
        regex_uri: ["/hub/(.*)", "/$1"]
  -
    uri: /wui
    plugins:
      redirect:
        uri: /wui/
      response-rewrite:
        headers: 
          set:
            # Fix CWE Id: 693
            Content-Security-Policy: "default-src https: data: blob: 'self'; connect-src 'self' data: blob:; media-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob:; font-src 'self'; img-src 'self' data: blob:; frame-ancestors 'none'; form-action 'self'; object-src 'none'; manifest-src 'self'; frame-src 'self'"
            # Fix CWE Id: 200
            Server: "ARLAS services"
            # Fix CWE Id: 319 // Value recommended by https://hstspreload.org/
            Strict-Transport-Security: max-age=63072000; includeSubDomains; preload
            # Fix CWE Id: 693
            X-Content-Type-Options: nosniff
  -
    uri: /wui/*
    upstream:
      nodes:
        "arlas-wui:80": 1
    plugins:
#      response-rewrite:
#        headers: 
#          set:
            # Fix CWE Id: 693
#            Content-Security-Policy: "default-src https: data: blob: 'self'; connect-src  https://api.maptiler.com 'self' data: blob:; media-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob:; font-src 'self'; img-src 'self' data: blob:; frame-ancestors 'none'; form-action 'self'; object-src 'none'; manifest-src 'self'; frame-src 'self'"
            # Fix CWE Id: 1021
#            X-Frame-Options: "DENY"
            # Fix CWE Id: 693 // The () means those resources are not allowed.
#            Permissions-Policy: accelerometer=(), camera=(), microphone=(), geolocation=(), usb=()
            # Fix CWE Id: 200
 #           Server: "ARLAS services"
            # Fix CWE Id: 319 // Value recommended by https://hstspreload.org/
  #          Strict-Transport-Security: max-age=63072000; includeSubDomains; preload
            # Fix CWE Id: 693
   #         X-Content-Type-Options: nosniff
      proxy-rewrite:
        regex_uri: ["/wui/(.*)", "/$1"]
  -
    uri: /arlas_permissions_server/healthcheck
    methods: ["GET"]
    upstream:
      nodes:
        "arlas-permissions-server:9996": 1
    plugins:
      proxy-rewrite:
        regex_uri: ["/arlas_permissions_server/healthcheck", "/admin/healthcheck"]
      response-rewrite:
        headers: 
          set:
            # Fix CWE Id: 693
            Content-Security-Policy: "default-src https: data: blob: 'self'; connect-src 'self' data: blob:; media-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob:; font-src 'self'; img-src 'self' data: blob:; frame-ancestors 'none'; form-action 'self'; object-src 'none'; manifest-src 'self'; frame-src 'self'"
            # Fix CWE Id: 200
            Server: "ARLAS services"
            # Fix CWE Id: 319 // Value recommended by https://hstspreload.org/
            Strict-Transport-Security: max-age=63072000; includeSubDomains; preload
            # Fix CWE Id: 693
            X-Content-Type-Options: nosniff
  -
    uri: /arlas_permissions_server/*
    upstream:
      nodes:
        "arlas-permissions-server:9996": 1
    plugins:
      response-rewrite:
        headers: 
          set:
            # Fix CWE Id: 693
            Content-Security-Policy: "default-src https: data: blob: 'self'; connect-src 'self' data: blob:; media-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob:; font-src 'self'; img-src 'self' data: blob:; frame-ancestors 'none'; form-action 'self'; object-src 'none'; manifest-src 'self'; frame-src 'self'"
            # Fix CWE Id: 200
            Server: "ARLAS services"
            # Fix CWE Id: 319 // Value recommended by https://hstspreload.org/
            Strict-Transport-Security: max-age=63072000; includeSubDomains; preload
            # Fix CWE Id: 693
            X-Content-Type-Options: nosniff
  -
    uri: /persist/healthcheck
    methods: ["GET"]
    upstream:
      nodes:
        "arlas-persistence-server:9997": 1
    plugins:
      proxy-rewrite:
        regex_uri: ["/persist/healthcheck", "/admin/healthcheck"]
      response-rewrite:
        headers: 
          set:
            # Fix CWE Id: 693
            Content-Security-Policy: "default-src https: data: blob: 'self'; connect-src 'self' data: blob:; media-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob:; font-src 'self'; img-src 'self' data: blob:; frame-ancestors 'none'; form-action 'self'; object-src 'none'; manifest-src 'self'; frame-src 'self'"
            # Fix CWE Id: 200
            Server: "ARLAS services"
            # Fix CWE Id: 319 // Value recommended by https://hstspreload.org/
            Strict-Transport-Security: max-age=63072000; includeSubDomains; preload
            # Fix CWE Id: 693
            X-Content-Type-Options: nosniff
  -
    uri: /persist/*
    upstream:
      nodes:
        "arlas-persistence-server:9997": 1
    plugins:
      response-rewrite:
        headers: 
          set:
            # Fix CWE Id: 693
            Content-Security-Policy: "default-src https: data: blob: 'self'; connect-src 'self' data: blob:; media-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob:; font-src 'self'; img-src 'self' data: blob:; frame-ancestors 'none'; form-action 'self'; object-src 'none'; manifest-src 'self'; frame-src 'self'"
            # Fix CWE Id: 200
            Server: "ARLAS services"
            # Fix CWE Id: 319 // Value recommended by https://hstspreload.org/
            Strict-Transport-Security: max-age=63072000; includeSubDomains; preload
            # Fix CWE Id: 693
            X-Content-Type-Options: nosniff
  -
    uri: /arlas/healthcheck
    methods: ["GET"]
    upstream:
      nodes:
        "arlas-server:9999": 1
    plugins:
      proxy-rewrite:
        regex_uri: ["/arlas/healthcheck", "/admin/healthcheck"]
      response-rewrite:
        headers: 
          set:
            # Fix CWE Id: 693
            Content-Security-Policy: "default-src https: data: blob: 'self'; connect-src 'self' data: blob:; media-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob:; font-src 'self'; img-src 'self' data: blob:; frame-ancestors 'none'; form-action 'self'; object-src 'none'; manifest-src 'self'; frame-src 'self'"
            # Fix CWE Id: 200
            Server: "ARLAS services"
            # Fix CWE Id: 319 // Value recommended by https://hstspreload.org/
            Strict-Transport-Security: max-age=63072000; includeSubDomains; preload
            # Fix CWE Id: 693
            X-Content-Type-Options: nosniff
  -
    uri: /arlas/*
    upstream:
      nodes:
        "arlas-server:9999": 1
    plugins:
      proxy-rewrite:
        headers: 
          set:
            # Fix CWE Id: 1021
            Access-Control-Allow-Origin: "https://${ARLAS_HOST}"
      response-rewrite:
        headers: 
          set:
            # Fix CWE Id: 693
            Content-Security-Policy: "default-src https: data: blob: 'self'; connect-src 'self' data: blob:; media-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob:; font-src 'self'; img-src 'self' data: blob:; frame-ancestors 'none'; form-action 'self'; object-src 'none'; manifest-src 'self'; frame-src 'self'"
            # Fix CWE Id: 200
            Server: "ARLAS services"
            # Fix CWE Id: 319 // Value recommended by https://hstspreload.org/
            Strict-Transport-Security: max-age=63072000; includeSubDomains; preload
            # Fix CWE Id: 693
            X-Content-Type-Options: nosniff
  -
    uri: /basemaps/*
    methods: ["GET"]
    upstream:
      nodes:
        "protomaps:8080": 1
  -
    uri: /iam
    plugins:
      redirect:
        uri: /iam/
      response-rewrite:
        headers: 
          set:
            # Fix CWE Id: 693
            Content-Security-Policy: "default-src https: data: blob: 'self'; connect-src 'self' data: blob:; media-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob:; font-src 'self'; img-src 'self' data: blob:; frame-ancestors 'none'; form-action 'self'; object-src 'none'; manifest-src 'self'; frame-src 'self'"
            # Fix CWE Id: 200
            Server: "ARLAS services"
            # Fix CWE Id: 319 // Value recommended by https://hstspreload.org/
            Strict-Transport-Security: max-age=63072000; includeSubDomains; preload
            # Fix CWE Id: 693
            X-Content-Type-Options: nosniff
  -
    uri: /iam/*
    upstream:
      nodes:
        "arlas-wui-iam:80": 1
    plugins:
      response-rewrite:
        headers: 
          set:
            # Fix CWE Id: 693
            Content-Security-Policy: "default-src https: data: blob: 'self'; connect-src 'self' data: blob:; media-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob:; font-src 'self'; img-src 'self' data: blob:; frame-ancestors 'none'; form-action 'self'; object-src 'none'; manifest-src 'self'; frame-src 'self'"
            # Fix CWE Id: 1021
            X-Frame-Options: "DENY"
            # Fix CWE Id: 693 // The () means those resources are not allowed.
            Permissions-Policy: accelerometer=(), camera=(), microphone=(), geolocation=(), usb=()
            # Fix CWE Id: 200
            Server: "ARLAS services"
            # Fix CWE Id: 319 // Value recommended by https://hstspreload.org/
            Strict-Transport-Security: max-age=63072000; includeSubDomains; preload
            # Fix CWE Id: 693
            X-Content-Type-Options: nosniff
  -
    uri: /arlas_iam_server/*
    upstream:
      nodes:
        "arlas-iam-server:9998": 1
    plugins:
      proxy-rewrite:
        headers: 
          set:
            # Fix CWE Id: 1021
            Access-Control-Allow-Origin: "https://${ARLAS_HOST}"
      response-rewrite:
        headers: 
          set:
            # Fix CWE Id: 693
            Content-Security-Policy: "default-src https: data: blob: 'self'; connect-src 'self' data: blob:; media-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob:; font-src 'self'; img-src 'self' data: blob:; frame-ancestors 'none'; form-action 'self'; object-src 'none'; manifest-src 'self'; frame-src 'self'"
            # Fix CWE Id: 200
            Server: "ARLAS services"
            # Fix CWE Id: 319 // Value recommended by https://hstspreload.org/
            Strict-Transport-Security: max-age=63072000; includeSubDomains; preload
            # Fix CWE Id: 693
            X-Content-Type-Options: nosniff
  -
    uri: /arlas_iam_server/healthcheck
    methods: ["GET"]
    upstream:
      nodes:
        "arlas-iam-server:9998": 1
    plugins:
      proxy-rewrite:
        regex_uri: ["/arlas_iam_server/healthcheck", "/admin/healthcheck"]
      response-rewrite:
        headers: 
          set:
            # Fix CWE Id: 693
            Content-Security-Policy: "default-src https: data: blob: 'self'; connect-src 'self' data: blob:; media-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob:; font-src 'self'; img-src 'self' data: blob:; frame-ancestors 'none'; form-action 'self'; object-src 'none'; manifest-src 'self'; frame-src 'self'"
            # Fix CWE Id: 200
            Server: "ARLAS services"
            # Fix CWE Id: 319 // Value recommended by https://hstspreload.org/
            Strict-Transport-Security: max-age=63072000; includeSubDomains; preload
            # Fix CWE Id: 693
            X-Content-Type-Options: nosniff
  -
    uri: /fam-wui
    plugins:
      redirect:
        uri: /fam-wui/
      response-rewrite:
        headers: 
          set:
            # Fix CWE Id: 693
            Content-Security-Policy: "default-src https: data: blob: 'self'; connect-src 'self' data: blob:; media-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob:; font-src 'self'; img-src 'self' data: blob:; frame-ancestors 'none'; form-action 'self'; object-src 'none'; manifest-src 'self'; frame-src 'self'"
            # Fix CWE Id: 200
            Server: "ARLAS services"
            # Fix CWE Id: 319 // Value recommended by https://hstspreload.org/
            Strict-Transport-Security: max-age=63072000; includeSubDomains; preload
            # Fix CWE Id: 693
            X-Content-Type-Options: nosniff
  -
    uri: /fam-wui/*
    upstream:
      nodes:
        "arlas-fam-wui:80": 1
    plugins:
      response-rewrite:
        headers: 
          set:
            # Fix CWE Id: 693
            Content-Security-Policy: "default-src https: data: blob: 'self'; connect-src 'self' data: blob:; media-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob:; font-src 'self'; img-src 'self' data: blob:; frame-ancestors 'none'; form-action 'self'; object-src 'none'; manifest-src 'self'; frame-src 'self'"
            # Fix CWE Id: 1021
            X-Frame-Options: "DENY"
            # Fix CWE Id: 693 // The () means those resources are not allowed.
            Permissions-Policy: accelerometer=(), camera=(), microphone=(), geolocation=(), usb=()
            # Fix CWE Id: 200
            Server: "ARLAS services"
            # Fix CWE Id: 319 // Value recommended by https://hstspreload.org/
            Strict-Transport-Security: max-age=63072000; includeSubDomains; preload
            # Fix CWE Id: 693
            X-Content-Type-Options: nosniff
      proxy-rewrite:
        regex_uri: ["/fam-wui/(.*)", "/$1"]
  -
    uri: /agate/healthcheck
    methods: ["GET"]
    upstream:
      nodes:
        "agate:8004": 1
  -
    uri: /airs-storage/*
    methods: ["GET"]
    upstream:
      nodes:
        "minio:9000": 1
    plugins:
      forward-auth:
        uri: http://agate:8004/agate/authorization
        request_headers: ["Authorization", "arlas-org-filter"]
  -
    uri: /fam/*
    upstream:
      nodes:
        "fam-service:8005": 1
    plugins:
      forward-auth:
        uri: http://arlas-iam-server:9998/arlas_iam_server/auth
        request_headers: ["Authorization", "arlas-org-filter"]
  -
    uri: /fam/files
    upstream:
      nodes:
        "fam-service:8005": 1
    plugins:
      forward-auth:
        uri: http://arlas-iam-server:9998/arlas_iam_server/auth
        request_headers: ["Authorization", "arlas-org-filter"]
      # proxy-rewrite:
      #   headers: 
      #     set:
      #       # Fix CWE Id: 1021
      #       Access-Control-Allow-Origin: "https://${ARLAS_HOST}"
      # response-rewrite:
      #   headers: 
      #     set:
      #       # Fix CWE Id: 693
      #       Content-Security-Policy: "default-src https: data: blob: 'self'; connect-src 'self' data: blob:; media-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob:; font-src 'self'; img-src 'self' data: blob:; frame-ancestors 'none'; form-action 'self'; object-src 'none'; manifest-src 'self'; frame-src 'self'"
      #       # Fix CWE Id: 200
      #       Server: "ARLAS services"
      #       # Fix CWE Id: 319 // Value recommended by https://hstspreload.org/
      #       Strict-Transport-Security: max-age=63072000; includeSubDomains; preload
      #       # Fix CWE Id: 693
      #       X-Content-Type-Options: nosniff
  -
    uri: /airs/healthcheck
    methods: ["GET"]
    upstream:
      nodes:
        "airs-server:8000": 1
  -
    uri: /airs/collections/*
    upstream:
      nodes:
        "airs-server:8000": 1
    plugins:
      forward-auth:
        uri: http://arlas-iam-server:9998/arlas_iam_server/auth
        request_headers: ["Authorization", "arlas-org-filter"]
  -
    uri: /aproc/healthcheck
    methods: ["GET"]
    upstream:
      nodes:
        "aproc-service:8001": 1
  -
    uri: /aproc/processes/*
    upstream:
      nodes:
        "aproc-service:8001": 1
    plugins:
      forward-auth:
        uri: http://arlas-iam-server:9998/arlas_iam_server/auth
        request_headers: ["Authorization", "arlas-org-filter"]
  -
    uri: /aproc/jobs
    upstream:
      nodes:
        "aproc-service:8001": 1
    plugins:
      forward-auth:
        uri: http://arlas-iam-server:9998/arlas_iam_server/auth
        request_headers: ["Authorization", "arlas-org-filter"]
  -
    uri: /aproc/jobs/*
    upstream:
      nodes:
        "aproc-service:8001": 1
    plugins:
      forward-auth:
        uri: http://arlas-iam-server:9998/arlas_iam_server/auth
        request_headers: ["Authorization", "arlas-org-filter"]
ssls:
  -
    snis:
      - "localhost"
      - "${ARLAS_HOST}"
    cert: |
${SSL_CERT}
    key: |
${SSL_KEY}
#END
